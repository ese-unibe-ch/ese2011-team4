#{extends 'main.html' /}
#{set title:calendar.name/}

<div id="main-left">
	<h2 class="title"><span id="calendar-name">${calendar.name}</span></h2>
	<div id="calendar">
	<div id="calendar-navigation">
			<span id="previous-month">
				#{a @Calendars.show(calendar.id, dt.minusMonths(1).getYear(), dt.minusMonths(1).getMonthOfYear(), dt.minusMonths(1).getDayOfMonth())}
				<< ${dt.minusMonths(1).monthOfYear().getAsText(new Locale("en","US"))}
				#{/a}
			</span>
			<span id="current-month">
				- ${dt.monthOfYear().getAsText(new Locale("en","US"))}, ${dt.getYear()} -
			</span>
			<span id="next-month">
				#{a @Calendars.show(calendar.id, dt.plusMonths(1).getYear(), dt.plusMonths(1).getMonthOfYear(), dt.plusMonths(1).getDayOfMonth())}
				${dt.plusMonths(1).monthOfYear().getAsText(new Locale("en","US"))} >>
				#{/a}
			</span>
	</div>
	
	#{if flash.success}
		<p class="success">${flash.success}</p>
	#{/if}
	
	<table id="month">
		<tr>
			<td class="title">Mon</td>
			<td class="title">Tue</td>
			<td class="title">Wed</td>
			<td class="title">Thu</td>
			<td class="title">Fri</td>
			<td class="title">Sat</td>
			<td class="title">Sun</td>
		</tr>
		<tr>
		#{if (calendar.getDaysInMonth(dt)[0].getDayOfWeek()+6)%7 > 0}
			#{list items:1..(calendar.getDaysInMonth(dt)[0].getDayOfWeek()+6)%7, as:'i'}
				<td></td>
			#{/list}
		#{/if}
					
		#{list items:calendar.getDaysInMonth(dt), as:'day'}
			<td class="#{if calendar.eventsByDay(day, connectedUser).size() > 0}events#{/if}
				#{if day.getDayOfMonth() == dt.getDayOfMonth()}selected#{/if}">
				#{a @Calendars.show(calendar.id, day.getYear(), day.getMonthOfYear(), day.getDayOfMonth())}
					${day.getDayOfMonth()}
				#{/a}
			</td>
		
			#{if day.getDayOfWeek()==7}
				</tr><tr>
			#{/if}
		#{/list}
	
		#{if calendar.getDaysInMonth(dt)[calendar.getDaysInMonth(dt).size-1].getDayOfWeek()%7 > 0}
			#{list items:calendar.getDaysInMonth(dt)[calendar.getDaysInMonth(dt).size-1].getDayOfWeek()%7 .. 6, as:'i'}
				<td></td>
			#{/list}
		#{/if}		
		</tr>
	</table>

	<div id="events">
	#{if events.size() > 0}
		<ul>
		<hr />
		#{list items:events, as:'event'}
			#{event calendar:calendar, event:event, connectedUser:connectedUser /}
		#{/list}
		</ul>
	#{/if}
		
	#{else}
		<div class="empty">
	        There are no events for the selected date.
	    </div>
	#{/else}
	</div>
</div>
</div>

<div id="main-right">
	<h2 class="title">Options</h2>
	<div class="navigation">
	<ul>
		<li><a class="navigation" href="@{Calendars.index}">Go back</a></li>
		<li><a class="navigation" href="@{Calendars.showCurrentMonth(calendar.id)}">Today</a></li>
		#{secure.check calendar}
		<li><a class="navigation" href="@{Events.add(calendar.id, dt.getYear(), dt.getMonthOfYear(), dt.getDayOfMonth())}">Add an event</a></li>
		#{/secure.check}
	</ul>
	</div>
</div>